<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Container Creation Status</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="/style.css" rel="stylesheet">
    <script src="https://unpkg.com/ansi_up@4.0.4/ansi_up.js"></script>
    <style>
        body { font-family: monospace; background-color: #282c34; color: #161616; }
        .log-container {
            white-space: pre-wrap;
            overflow-wrap: break-word;
        }
        .status-message { font-weight: bold; margin-top: 1em; }
    </style>
</head>
<body>
    <div class="login-container">
        <img src="/logo.png" alt="Company Logo" class="logo">
        <h2>Container Creation Log</h2>
        <pre id="log" class="log-container"></pre>
        <div id="status" class="status-message">Status: Running...</div>
    </div>

    <script>
        // Wait until the entire page is loaded before running the script
        document.addEventListener('DOMContentLoaded', function() {
            const logElement = document.getElementById('log');
            const statusElement = document.getElementById('status');
            const jobId = window.location.pathname.split('/').pop();

            // Define the AnsiUp instance for converting ANSI codes to HTML
            const ansi_up = new AnsiUp();

            const eventSource = new EventSource(`/api/stream/${jobId}`);

            eventSource.onmessage = function(event) {
                const data = JSON.parse(event.data);
                const html = ansi_up.ansi_to_html(data);
                logElement.innerHTML += html;
            };

            eventSource.addEventListener('close', function(event) {
                statusElement.textContent = `Status: ${event.data}`;
                eventSource.close();
            });

            eventSource.onerror = function(err) {
                console.error("EventSource failed:", err);
                statusElement.textContent = 'Error: Connection to server lost.';
                eventSource.close();
            };
        });
    </script>
</body>
</html>